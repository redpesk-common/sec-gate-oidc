{
  "name": "afb-oidc",
  "tracereq": "none",
  "verbose": 2,
  "port": 1234,
  "https": true,
  "https-cert": "../conf.d/project/ssl/devel-cert.pem",
  "https-key": "../conf.d/project/ssl/devel-key.pem",
  "extension": "libafb-sgate-oidc-ext.so",
  "roothttp": ".",
  "rootdir":  "../conf.d/project/htdocs",
  "binding" : [{"uid": "fedid-api", "path": "/usr/local/fedid-binding/lib/fedid-binding.so", "config": {"dbpath":"/var/tmp/fedid-sqllite.db"}}],
  "@extconfig": {
    "sgate-oidc": {
      "api": "sgate",
      "info": "oidc secure gateway local authentication sample config",
      "globals": {
          "login": "/sgate/common/login.html",
          "register": "/sgate/common/register.html",
          "fedlink": "/sgate/common/fedlink.html",
          "error": "/sgate/common/error.html",
          "timeout": 600
      },
      "idps": [
        {
            "uid": "pam",
            "info": "Linux local authentication",
            "plugin": {
              "info": "custom params for pam plugin (note: idp->uid:pam-login should match one plugin idp uid)",
              "ldpath": "libidp-sgate-pam-auth.so",
              "gids":16
            },
            "statics": {
                "login": "/sgate/pam/login",
                "logo": "/sgate/pam/logo-64px.png",
                "timeout": 900
            },
            "profiles": [
                {"uid":"login", "loa":1, "scope":"login"}
            ]
        }, {
            "uid": "ldap-iotbzh",
            "type": "ldap",
            "info": "Iot.bzh internal LDAP",
            "statics": {
                "login": "/sgate/ldap/login",
                "logo": "/sgate/ldap/logo-64px.png",
                "timeout": 900
            },
            "schema": {
                "info": "generate a curl -u %userdn% %ldapuri%/%groupdn%?dn?sub?%filter%",
                "uri": "ldap://ldap.ovh.iot",
                "login": "uid=%login%,ou=People,dc=vannes,dc=iot",
                "groups": "ou=groups,dc=vannes,dc=iot?dn?sub?(memberUid=%login%)",
                "people": "ou=people,dc=vannes,dc=iot?uid,gecos,mail?sub?(cn=%login%)",
            },
            "wellknown": {
                "tokenid": "/sgate/ldap/login.html"
            },
            "profiles": [
                {"uid":"login", "loa":1, "scope":"login"}
            ]
        }
      ],
      "apis": [
        {"uid": "fedid","info":"embedded social federated user identity svc","loa":0,"uri":"@fedid"},
        {"uid": "test1","lazy":1},
        {"uid": "test2","uri":"unix:@test2", "loa":1, "require": ["user"], "lazy":1},
        {"uid": "test3","uri":"tcp:localhost:1235/test3", "loa":2, "require": ["user","admin"], "lazy":1},
        {"uid": "simple","uri":"unix:/tmp/spawn-binding/simple", "loa":1, "require": ["user"], "lazy":1}
        ],
      "alias": [
        {"uid": "idp-common", "url":"/sgate/common", "path":"idps/common" },
        {"uid": "idp-github"  , "url":"/sgate/github","loa":0, "path":"idps/github" },
        {"uid": "idp-pam"     , "url":"/sgate/pam"   ,"loa":0, "path":"idps/pam" },
        {"uid": "idp-ldap"    , "url":"/sgate/ldap"   ,"loa":0, "path":"idps/ldap" },
        {"uid": "idp-phantauth" , "url":"/sgate/phantauth"   ,"loa":0, "path":"idps/phantauth" },
        {"uid": "idp-onelogin" , "url":"/sgate/onelogin"   ,"loa":0, "path":"idps/onelogin" },
        {"uid": "public" , "info": "Anonymous access allowed", "url":"/public", "path":"public" },
        {"uid": "private", "info": "Required basic authentication", "url":"/private",  "loa":1, "path":"private" },
        {"uid": "confidential", "info": "Required teams authentication", "url":"/confidential", "loa":2, "path":"confidential" },
        {"uid": "admin", "info": "Required admin security attribute", "url":"/admin", "loa":1, "path":"admin", "require": ["wheel","iotbzh","sudo"]},
      ]
    }
  }
}

